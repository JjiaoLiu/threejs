<!DOCTYPE html>
<html lang="en">
  <head>
    <title>shape</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <style type="text/css">
      div#canvas-frame {
        border: none;
        cursor: pointer;
        width: 100%;
        height: 600px;
        background-color: #eeeeee;
      }
    </style>
    <!-- Import maps polyfill -->
    <!-- Remove this when import maps will be widely supported -->
    <script
      async
      src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"
    ></script>
    <script type="importmap">
      {
        "imports": {
          "three": "./node_modules/three/build/three.module.js"
        }
      }
    </script>
    <script type="module">
      import * as THREE from "./node_modules/three/src/Three.js";
      import { OrbitControls } from "./node_modules/three/examples/jsm/controls/OrbitControls.js";
      var scene,
        camera,
        mesh,
        renderer,
        r,
        angle1 = 0,
        angle2 = 0,
        fov = 45,
        near = 20,
        far = 10000;
      function init() {
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(
          fov,
          window.innerWidth / window.innerHeight,
          near,
          far
        );
        camera.position.set(1000, 1000, 1000);
        camera.lookAt(0, 0, 0);
        r = Math.sqrt(3000000);
        const sizes = {
          width: window.innerWidth,
          height: window.innerHeight,
        };
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(sizes.width, sizes.height);
        renderer.setClearColor(0xeeffff, 1.0);
        document.body.appendChild(renderer.domElement);
      }
      function initObj() {
        var shape = new THREE.Shape();
        var R = 50;
        shape.absarc(0, 0, R, 0, Math.PI);
        shape.lineTo(-R, -200);
        shape.absarc(0, -200, R, Math.PI, 2 * Math.PI);
        shape.lineTo(R, 0);
        var path1 = new THREE.Path();
        path1.arc(0, 0, 40, 0, 2 * Math.PI);
        shape.holes.push(path1);

        var geometry = new THREE.ShapeGeometry(shape, 30);

        var material = new THREE.MeshBasicMaterial({
          color:0xff0000
        });

        mesh = new THREE.Mesh(geometry,material)
        mesh.name = 'Box'
        scene.add(mesh)
      }
      var clip1;
      var clip2;
      function clipTrack () {
        var times = [0, 10]; //关键帧时间数组，离散的时间点序列
        var values = [0, 0, 0, 150, 0, 0]; //与时间点对应的值组成的数组
        // 创建位置关键帧对象：0时刻对应位置0, 0, 0   10时刻对应位置150, 0, 0
        var posTrack = new THREE.KeyframeTrack('Box.position', times, values);
        // 创建颜色关键帧对象：10时刻对应颜色1, 0, 0   20时刻对应颜色0, 0, 1
        var colorKF = new THREE.KeyframeTrack('Box.material.color', times, [1, 0, 0, 0, 0, 1]);
        // duration决定了默认的播放时间，一般取所有帧动画的最大时间
        // duration偏小，帧动画数据无法播放完，偏大，播放完帧动画会继续空播放
        var duration = 10;
        // 多个帧动画作为元素创建一个剪辑clip对象，命名"default"，持续时间20
        clip1 = new THREE.AnimationClip("position", duration, [posTrack]);
        clip2 = new THREE.AnimationClip("color", duration, [colorKF]);
        mesh.animations = [clip1,clip2]
      }
      var mixer;
      function Animation () {
        mixer = new THREE.AnimationMixer( mesh );
        var animations = mesh.animations;
        animations.forEach( i => {
          mixer.clipAction(i).play()
          mixer.addEventListener( 'loop', ( e ) =>{
            mixer.clipAction(i).stop()
          });
        })
        
      }
      var light;
      function initLight() {
        light = new THREE.DirectionalLight(0xff0000, 1.0, 0);
        light.position.set(500, 500, 500);
        scene.add(light);
      }
      function initGrid() {
        let helper = new THREE.GridHelper(1000, 50, 0x0000ff, 0x808080);
        scene.add(helper);
      }
      let orbitControls;
      function initControls() {
        orbitControls = new OrbitControls(camera, renderer.domElement);
      }
      init();
      initLight();
      initObj();
      clipTrack();
      Animation();
      initGrid();
      initControls();
      var clock = new THREE.Clock();
      function animate() {
        requestAnimationFrame(animate);
        orbitControls.update();
        renderer.render(scene, camera);
        mixer.update(clock.getDelta())
      }
      animate();
    </script>
  </head>

  <body></body>
</html>
